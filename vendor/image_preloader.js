// Generated by CoffeeScript 1.5.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  this.ImagePreloader = (function() {

    function ImagePreloader(options) {
      if (options == null) {
        options = {};
      }
      this.onImageLoad = __bind(this.onImageLoad, this);
      this.start = __bind(this.start, this);
      this.loadedCount = 0;
      this.urls = options.urls, this.imageLoad = options.imageLoad, this.complete = options.complete;
    }

    ImagePreloader.prototype.start = function() {
      var image, imageUrl, _i, _len, _ref, _results, _this;
      _this = this;
      _ref = this.urls || [];
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        imageUrl = _ref[_i];
        image = new Image();
        image.onabort = function() {
          return _this.onImageLoad(this, {
            abort: true
          });
        };
        image.onerror = function() {
          return _this.onImageLoad(this, {
            error: true
          });
        };
        image.onload = function() {
          return _this.onImageLoad(this);
        };
        _results.push(image.src = imageUrl);
      }
      return _results;
    };

    ImagePreloader.prototype.onImageLoad = function(image, attributes) {
      var details;
      if (attributes == null) {
        attributes = {};
      }
      this.loadedCount += 1;
      details = {
        url: image.src,
        loadedCount: this.loadedCount,
        totalCount: this.urls.length,
        abort: !!attributes.abort,
        error: !!attributes.error
      };
      if (typeof this.imageLoad === "function") {
        this.imageLoad(details);
      }
      if (this.loadedCount >= this.urls.length) {
        return typeof this.complete === "function" ? this.complete(this.urls) : void 0;
      }
    };

    return ImagePreloader;

  })();

}).call(this);
